<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Detail - LUNAIRE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    .font-playfair { font-family: 'Playfair Display', serif; }
    .font-inter { font-family: 'Inter', sans-serif; }
    .font-lunaire { font-family: 'Playfair Display', serif; font-weight: 500; }
    .dropdown-menu { transform: translateX(-100%); transition: transform 0.3s ease-in-out; }
    .dropdown-menu.open { transform: translateX(0); }
    .overlay { opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; }
    .overlay.open { opacity: 1; visibility: visible; }
    
    /* Luxury Image Hover Effect */
    .img-zoom-container img { transition: transform 1.2s cubic-bezier(0.16, 1, 0.3, 1); }
    .img-zoom-container:hover img { transform: scale(1.05); }
  </style>
</head>
<body class="bg-gray-50 font-inter">

  <header class="relative bg-white border-b border-gray-200 z-50">
    <div class="flex items-center px-4 md:px-6 py-4">
      <button id="menuToggle" class="flex flex-col space-y-1.5 p-2 md:p-3 hover:bg-gray-100 rounded-md transition-colors mr-3 md:mr-6">
        <span class="w-6 md:w-7 h-0.5 bg-black transition-all"></span>
        <span class="w-6 md:w-7 h-0.5 bg-black transition-all"></span>
        <span class="w-6 md:w-7 h-0.5 bg-black transition-all"></span>
      </button>

      <a href="Homepage.html" class="flex-1">
        <h1 class="font-lunaire text-3xl md:text-4xl text-black tracking-wide cursor-pointer uppercase">LUNAIRE</h1>
      </a>

      <div id="searchBar" class="hidden absolute left-0 right-0 top-full bg-white px-4 py-3 border-b border-gray-200 md:relative md:flex-1 md:max-w-md md:mx-4 md:border-0 md:p-0">
        <div class="relative">
          <input type="text" id="searchInput" placeholder="Search products..." class="w-full border border-gray-300 rounded-md px-4 py-2 pr-10 focus:outline-none focus:ring-2 focus:ring-black text-base">
          <button id="clearSearch" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-black hidden">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <div class="flex items-center space-x-2 md:space-x-4">
        <button id="searchToggle" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
          <i class="fas fa-search text-black text-lg md:text-xl"></i>
        </button>
        <button class="p-2 hover:bg-gray-100 rounded-full transition-colors">
          <i class="fas fa-user text-black text-lg md:text-xl"></i>
        </button>
        <a href="basket.html" class="p-2 hover:bg-gray-100 rounded-full transition-colors relative">
          <i class="fas fa-shopping-bag text-black text-lg md:text-xl"></i>
          <span id="cartCount" class="absolute -top-1 -right-1 bg-black text-white text-[10px] sm:text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
        </a>
      </div>
    </div>
  </header>

  <div id="overlay" class="overlay fixed inset-0 bg-black bg-opacity-50 z-40"></div>
  <nav id="dropdownMenu" class="dropdown-menu fixed left-0 top-0 h-full w-80 bg-white shadow-2xl z-50 overflow-y-auto">
    <div class="p-6">
      <div class="mb-8"><h2 class="font-lunaire text-xl text-black">LUNAIRE</h2></div>
      <ul class="space-y-4">
        <li><a href="Homepage.html" class="block text-gray-700 hover:text-black font-medium">Home</a></li>
        <li>
          <button class="flex justify-between items-center w-full text-gray-700 hover:text-black font-medium submenu-btn">
            Shop <span class="transform transition-transform">â–¾</span>
          </button>
          <ul class="ml-4 mt-2 space-y-2 hidden submenu">
            <li><a href="AfterShp.html" class="block text-gray-500 hover:text-black">Collections</a></li>
          </ul>
        </li>
        <li><a href="faq.html" class="block text-gray-700 hover:text-black font-medium">FAQs</a></li>
      </ul>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div id="productDetailContainer">
        <div class="flex justify-center items-center py-20">
            <div class="w-10 h-10 border-4 border-gray-200 border-t-black rounded-full animate-spin"></div>
        </div>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <script>
    // 1. SIDEBAR & SEARCH LOGIC
    const menuToggle = document.getElementById("menuToggle");
    const dropdownMenu = document.getElementById("dropdownMenu");
    const overlay = document.getElementById("overlay");
    const searchToggle = document.getElementById("searchToggle");
    const searchBar = document.getElementById("searchBar");

    menuToggle.addEventListener("click", () => {
      dropdownMenu.classList.toggle("open");
      overlay.classList.toggle("open");
    });

    overlay.addEventListener("click", () => {
      dropdownMenu.classList.remove("open");
      overlay.classList.remove("open");
    });

    searchToggle.addEventListener("click", () => {
      searchBar.classList.toggle("hidden");
    });

    document.querySelectorAll(".submenu-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        const submenu = btn.nextElementSibling;
        submenu.classList.toggle("hidden");
        btn.querySelector("span").classList.toggle("rotate-180");
      });
    });

    // 2. DYNAMIC FOOTER LOADING
    fetch("footer.html")
      .then(response => response.text())
      .then(data => {
        document.getElementById("footer-placeholder").innerHTML = data;
      })
      .catch(err => console.error("Footer missing:", err));

    // 3. CART SYNC LOGIC
    function updateCartCount() {
      const cart = JSON.parse(localStorage.getItem('cartItems') || '[]');
      const total = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartCount').textContent = total;
    }

    // 4. LOAD PRODUCT DATA
    async function loadProduct() {
      const params = new URLSearchParams(window.location.search);
      const productId = params.get('id');
      const container = document.getElementById('productDetailContainer');

      try {
        const res = await fetch(`http://localhost:4000/api/products/${productId}`);
        const product = await res.json();

        container.innerHTML = `
          <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-20">
            <div class="lg:col-span-7">
              <div class="img-zoom-container overflow-hidden rounded-xl bg-white shadow-lg">
                <img src="http://localhost:4000/uploads/${product.image}" class="w-full h-auto object-cover" alt="${product.dressName}">
              </div>
            </div>
            <div class="lg:col-span-5 flex flex-col justify-center">
              <h1 class="font-playfair text-4xl lg:text-5xl font-bold text-gray-900 mb-4">${product.dressName}</h1>
              <p class="text-2xl text-gray-600 mb-8 font-inter font-light">PKR ${Number(product.price).toLocaleString()}</p>
              
              <div class="border-t border-gray-100 pt-8 space-y-6">
                <div>
                  <h4 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-2">Description</h4>
                  <p class="text-gray-600 text-sm leading-relaxed">${product.description || 'Premium craftsmanship meets timeless design.'}</p>
                </div>
                <div class="grid grid-cols-2 gap-4 text-xs uppercase tracking-widest font-bold text-gray-500">
                  <div class="bg-gray-100 p-3 rounded">Fabric: <span class="text-black">${product.fabricDetail}</span></div>
                  <div class="bg-gray-100 p-3 rounded">Color: <span class="text-black">${product.color}</span></div>
                </div>
                
                <button id="addBtn" class="w-full bg-black text-white py-5 rounded-lg font-bold uppercase tracking-widest hover:bg-neutral-800 transition-all active:scale-95 shadow-xl">
                  Add to Basket
                </button>
              </div>
            </div>
          </div>
        `;

        document.getElementById('addBtn').addEventListener('click', () => {
          let cart = JSON.parse(localStorage.getItem('cartItems') || '[]');
          const existing = cart.find(item => item.id === product._id);

          if (existing) {
            existing.quantity += 1;
          } else {
            cart.push({
              id: product._id,
              name: product.dressName,
              price: product.price,
              img: `http://localhost:4000/uploads/${product.image}`, // Keys MUST match basket.html
              size: product.size,
              quantity: 1
            });
          }

          localStorage.setItem('cartItems', JSON.stringify(cart));
          updateCartCount();

          const btn = document.getElementById('addBtn');
          btn.textContent = "Added to Bag";
          btn.classList.replace('bg-black', 'bg-neutral-600');
          setTimeout(() => {
            btn.textContent = "Add to Basket";
            btn.classList.replace('bg-neutral-600', 'bg-black');
          }, 1500);
        });

      } catch (err) {
        container.innerHTML = `<p class="text-red-500 text-center">Product data could not be retrieved.</p>`;
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadProduct();
      updateCartCount();
    });
  </script>
</body>
</html>